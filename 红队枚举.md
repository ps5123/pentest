SMB - 服务器消息块协议 - 是一种客户端-服务器通信协议，用于共享对网络上的文件、打印机、串行端口和其他资源的访问。

SMB 协议被称为响应请求协议，这意味着它在客户端和服务器之间传输多条消息以建立连接。客户端使用 TCP/IP（实际上是 RFC1001 和 RFC1002 中指定的 TCP/IP 上的 NetBIOS）、NetBEUI 或 IPX/SPX 连接到服务器。

枚举smb

枚举是收集有关目标的信息以找到潜在的攻击向量并帮助利用的过程。

枚举可用于收集用户名、密码、网络信息、主机名、应用程序数据、服务或任何其他可能对攻击者有价值的信息。



端口扫描

Enum4linux 是一个用于在 Windows 和Linux系统上枚举 SMB 共享的工具。它基本上是 Samba 包中工具的包装器，可以轻松快速地从与 SMB 相关的目标中提取信息。它默认安装在 Parrot 和 Kali 上，但是如果你需要安装它，你可以从官方github上安装。



Enum4Linux 的语法非常简单：“enum4linux [options] ip”

标签            功能

-U get userlist
-M get machine list
-N get namelist dump（区别于-U和-M）
-S get sharelist
-P get password policy information
-G get group and member list

-a 以上所有（完整的基本枚举）

刷完一边以后要看writeup，看看不同人的做法以及常规思路























枚举

拿到shell后，在shell上枚举

系统枚举

ls /etc/*-release

cat /etc/os-release



cat /etc/passwd

cat /etc/group

cat /etc/shadow （需要root文件权限）



ls -lh /var/mail/ 邮件目录



查看已安装的应用程序

ls -lh /usr/bin/

ls -lh /sbin/

在基于 RPM 的Linux系统上，您可以使用***rpm -qa***. 表示-qa我们要查询所有包。

在基于 Debian 的Linux系统上，您可以使用***dpkg -l***



用户

who

whoami

w   显示谁登录了以及他们在做什么

id

last 显示最后登录用户的列表；此外，我们可以看到谁登出以及他们保持连接的程度



sudo -l  列出了当前系统上调用用户的允许命令。



### networking

ip address show >> ip a s   或者ifconfig -a

cat /etc/resolv.conf

netstat是了解网络连接、路由表和接口统计信息的有用命令。我们在下表中解释了它的许多选项中的一些。

选项	描述
-a	显示监听和非监听套接字
-l	只显示监听套接字
-n	显示数字输出而不是解析 IP 地址和端口号
-t	TCP
-u	UDP协议
-x	UNIX
-p	显示套接字所属程序的PID和名称



请注意，要获取所有 PID（进程 ID）和程序名称，您需要netstat以 root 身份运行或使用sudo netstat



lsof代表列出打开的文件

如果我们只想显示 Internet 和网络连接，我们可以使用lsof -i

请注意，要获得匹配程序的完整列表，您需要lsof以 root 身份运行或使用sudo lsof.

因为列表可能会很长，您可以通过指定您感兴趣的端口（例如SMTP端口 25）来进一步过滤输出。通过运行lsof -i :25



运行服务

获取正在运行的进程的快照可以提供许多见解。ps让您发现正在运行的进程以及有关它们的大量信息。

您可以使用 列出系统上的每个进程ps -e，其中-e选择所有进程。有关该过程的更多信息，您可以添加-ffor full-format 和-lfor long format。试验ps -e、ps -ef和ps -el。

您可以获得可比较的输出并查看所有使用 BSD 语法的进程：ps ax或ps aux. 请注意，在使用 BSD 语法时，a和x是必需的，因为它们解除了“只有你自己”和“必须有一个 tty”的限制；换句话说，可以显示所有进程。用于u有关拥有该进程的用户的详细信息。

选项	描述
-e	所有过程
-f	全格式列表
-j	职位格式
-l	长格式
-u	面向用户的格式

总而言之，请记住使用ps -ef或ps aux获取所有正在运行的进程的列表。考虑通过管道输出grep以显示带有特定单词的输出行。下面的终端输出显示了其中的行peter。



枚举的很多命令，linux的，windows的都需要每天去敲的









### windows枚举

系统

systeminfo



 检查已安装的更新

wmic qfe get Caption, Description 



检查已安装和启动windows服务

net start 



检查已安装的应用程序

wmic product get name,version,vendor



 用户

whoami

whoami /priv  #权限

whoami /groups  #属于哪个组

net user   #查看用户

net group #查看组

net  localgroup administrator    #查看本地管理员组的用户

net accounts #查看机器上的本地设置



## 网络

ipconfig #查看简单的网络配置

ipconfig #查看所有网络配置



netstat #获取端口信息

-a  显示所有侦听端口和活动连接

-b  连接中涉及的二进制文件

-n 避免解析 IP 地址和端口号

-o 显示进程 ID (PID)

您可能认为通过端口扫描目标系统可以获得相同的结果；然而，这是不准确的，原因有二。防火墙可能会阻止扫描主机访问特定的网络端口。此外，端口扫描系统会产生相当大的流量，不像netstat，它会产生零噪音。



ARP代表地址解析协议

arp -a  显示当前的ARP条目，即与您的系统通信的同一 LAN 上的系统的物理地址







### DNS 域名系统

我们都熟悉域名系统 ( DNS ) 查询，我们可以在其中查找 A、AAAA、CName 和 TXT 记录等。如果您想温习 DNS 知识，我们建议您访问Detail room 中的 DNS。如果我们可以获得DNS服务器负责应答的所有记录的“副本”，我们可能会发现我们不知道存在的主机。

尝试DNS区域传输的一种简单方法是通过dig命令。如果您想了解更多有关dig和类似命令的信息，我们建议您查看被动侦察室。根据DNS服务器配置，DNS 区域传输可能会受到限制。如果不受限制，应该可以使用dig -t AXFR DOMAIN_NAME @DNS_SERVER. 表示-t AXFR我们正在请求区域传输，而在@之前表示DNS_SERVER我们要查询与指定 相关的记录DOMAIN_NAME。

net share #检查共享文件夹

dig -t AXFR DOMAIN_NAME @DNS_SERVER



-t AXFR  我们正在请求区域传输





### SNMP 简单网络管理协议  

帮助收集有关网络上不同设备的信息，了解各种网络事件，从磁盘出现故障的服务器到打印机墨水用完

SNMP 可以为攻击者保存大量信息。查询与 SNMP 相关的服务器的一种简单工具是“snmpcheck”“

如果您想snmpcheck在本地Linux机器上安装，请考虑以下命令。

git clone https://gitlab.com/kalilinux/packages/snmpcheck.git

cd snmpcheck/
gem install snmp
chmod +x snmpcheck-1.9.rb



/opt/snmpcheck/snmpcheck.rb 10.10.43.35 -c COMMUNITY_STRING 

敲snmpcheck命令会有大量信息不方面观察，配合linux的 | more 命令

/snmpcheck-1.9.rb 10.10.43.35 -c public  | more 

这样信息不会一次显示完，不会直接到底，而是先显示一部分，然后手动滚动鼠标来上下查看信息



以上介绍了多个命令行工具或者指令

三个不是命令行工具 GUI实用程序



Sysinternals Suite

Process Hacker

GhostPack Seatbelt



命令总结，之后可以做成表格融合进前面的模块，也可以单独拿出来做成每日任务，每天练习一下这些命令。

这个房间的重点是Linux和 MS Windows 系统中的内置命令行工具。两个系统中都存在许多命令，尽管命令参数和结果输出不同。下表显示了我们用来获取有关系统的更多信息所依赖的主要 Linux 和 MS Windows 命令。

Linux命令	描述
hostname	显示系统的主机名
who	显示谁登录了
whoami	显示有效的用户名
w	显示谁登录以及他们在做什么
last	显示最后登录用户的列表
ip address show	显示网络接口和地址
arp	显示ARP缓存
netstat	打印网络连接
ps	显示当前进程的快照



Windows 命令	描述
systeminfo	显示操作系统配置信息，包括服务包级别
whoami	显示用户名和组信息以及相应的安全标识符
netstat	显示协议统计信息和当前 TCP/IP 网络连接
net user	显示计算机上的用户帐户
net localgroup	显示计算机上的本地组
arp	显示 IP 到物理地址转换表